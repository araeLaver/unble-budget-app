<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unble - ìŠ¤ë§ˆíŠ¸ ê°€ê³„ë¶€</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
            overflow-x: hidden;
        }

        /* í—¤ë” */
        .header {
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .menu-toggle {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
        }

        .logo {
            font-size: 1.5em;
            font-weight: 700;
            color: #667eea;
        }

        .auth-section {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .auth-btn {
            padding: 8px 16px;
            background: none;
            border: 1px solid #667eea;
            color: #667eea;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .auth-btn:hover {
            background: #667eea;
            color: white;
        }

        .logout-btn {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 14px;
        }

        /* ì‚¬ì´ë“œë°” */
        .sidebar {
            position: fixed;
            left: -280px;
            top: 60px;
            bottom: 0;
            width: 280px;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            transition: left 0.3s;
            z-index: 99;
            overflow-y: auto;
        }

        .sidebar.active {
            left: 0;
        }

        .sidebar-overlay {
            position: fixed;
            top: 60px;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.3);
            display: none;
            z-index: 98;
        }

        .sidebar-overlay.active {
            display: block;
        }

        .nav-menu {
            padding: 20px 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            cursor: pointer;
            transition: background 0.3s;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-size: 16px;
        }

        .nav-item:hover {
            background: #f8f9fa;
        }

        .nav-item.active {
            background: #f0f4ff;
            color: #667eea;
            border-left: 3px solid #667eea;
        }

        .nav-icon {
            margin-right: 15px;
            font-size: 20px;
        }

        /* ë©”ì¸ ì»¨í…ì¸  */
        .main-content {
            margin-top: 60px;
            padding: 20px;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }

        /* ì›”ë³„ ìš”ì•½ ì¹´ë“œ */
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            text-align: center;
        }

        .summary-card h3 {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .summary-card .amount {
            font-size: 1.8em;
            font-weight: 700;
        }

        .income-amount { color: #27ae60; }
        .expense-amount { color: #e74c3c; }
        .balance-amount { color: #3498db; }

        /* ìº˜ë¦°ë” ë„¤ë¹„ê²Œì´ì…˜ */
        .calendar-nav {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .calendar-nav button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }

        .calendar-nav button:hover {
            background: #5a6fd8;
        }

        .calendar-nav h2 {
            font-size: 1.5em;
            color: #333;
        }

        /* ìº˜ë¦°ë” */
        .calendar-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }

        .calendar-header {
            text-align: center;
            font-weight: 600;
            color: #666;
            padding: 10px;
        }

        .calendar-day {
            aspect-ratio: 1;
            border: 1px solid #eee;
            border-radius: 10px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s;
            min-height: 100px;
            position: relative;
        }

        .calendar-day:hover {
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102,126,234,0.2);
        }

        .calendar-day.other-month {
            opacity: 0.3;
        }

        .calendar-day.today {
            background: #f0f4ff;
            border-color: #667eea;
        }

        .day-number {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .day-summary {
            font-size: 0.85em;
            line-height: 1.3;
        }

        .net-positive {
            background: #e8f8f3;
            border-color: #27ae60;
        }

        .net-negative {
            background: #fee;
            border-color: #e74c3c;
        }

        /* ì½˜í…ì¸  í˜ì´ì§€ */
        .content-page {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .content-page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        /* í¼ ìŠ¤íƒ€ì¼ */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #eee;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        .btn:hover {
            background: #5a6fd8;
        }

        .btn-block {
            width: 100%;
        }

        /* ê±°ë˜ ëª©ë¡ */
        .transaction-list {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .transaction-item:last-child {
            border-bottom: none;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .calendar-day {
                min-height: 80px;
                padding: 5px;
                font-size: 0.9em;
            }

            .summary-cards {
                grid-template-columns: 1fr;
            }

            .calendar-nav {
                flex-direction: column;
                gap: 10px;
            }

            .calendar-nav h2 {
                order: -1;
            }
        }

        /* ë¹„íšŒì› ì•Œë¦¼ */
        .guest-notice {
            background: #fff3cd;
            border: 1px solid #ffeeba;
            color: #856404;
            padding: 12px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .guest-notice button {
            background: #856404;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        /* ì¹´í…Œê³ ë¦¬ ê·¸ë¦¬ë“œ */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        /* ì°¨íŠ¸ ìŠ¤íƒ€ì¼ */
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-filters {
            display: flex;
            gap: 10px;
        }

        .filter-btn {
            padding: 8px 16px;
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .chart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .chart-item:last-child {
            border-bottom: none;
        }

        .chart-bar {
            height: 20px;
            background: #eee;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
            position: relative;
        }

        .chart-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .progress-ring {
            width: 120px;
            height: 120px;
            margin: 0 auto;
        }

        .progress-ring circle {
            fill: none;
            stroke-width: 8;
            transform-origin: 50% 50%;
            transform: rotate(-90deg);
        }

        .progress-ring .background {
            stroke: #f0f0f0;
        }

        .progress-ring .progress {
            stroke-linecap: round;
            transition: stroke-dasharray 0.5s ease;
        }

        .category-item {
            background: #f8f9fa;
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .category-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .category-icon {
            font-size: 24px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .category-info {
            flex: 1;
        }

        .category-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .category-type {
            font-size: 12px;
            color: #666;
        }

        .delete-category {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <header class="header">
        <div class="header-left">
            <button class="menu-toggle" onclick="toggleSidebar()">â˜°</button>
            <div class="logo">Unble</div>
        </div>
        <div class="auth-section" id="authSection">
            <button class="auth-btn" onclick="showAuthModal('login')">ë¡œê·¸ì¸</button>
            <button class="auth-btn" onclick="showAuthModal('register')">íšŒì›ê°€ì…</button>
        </div>
    </header>

    <!-- ì‚¬ì´ë“œë°” -->
    <aside class="sidebar" id="sidebar">
        <nav class="nav-menu">
            <button class="nav-item active" onclick="showPage('calendar', this)">
                <span class="nav-icon">ğŸ“…</span>
                ìº˜ë¦°ë”
            </button>
            <button class="nav-item" onclick="showPage('transactions', this)">
                <span class="nav-icon">ğŸ“‹</span>
                ê±°ë˜ ë‚´ì—­
            </button>
            <button class="nav-item" onclick="showPage('addTransaction', this)">
                <span class="nav-icon">â•</span>
                ê±°ë˜ ì¶”ê°€
            </button>
            <button class="nav-item" onclick="showPage('charts', this)">
                <span class="nav-icon">ğŸ“Š</span>
                ì°¨íŠ¸ ë¶„ì„
            </button>
            <button class="nav-item" onclick="showPage('assets', this)">
                <span class="nav-icon">ğŸ’°</span>
                ìì‚° ê´€ë¦¬
            </button>
            <button class="nav-item" onclick="showPage('categories', this)">
                <span class="nav-icon">ğŸ·ï¸</span>
                ì¹´í…Œê³ ë¦¬ ê´€ë¦¬
            </button>
            <button class="nav-item" onclick="showPage('settings', this)">
                <span class="nav-icon">âš™ï¸</span>
                ì„¤ì •
            </button>
        </nav>
    </aside>
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="main-content">
        <!-- ë¹„íšŒì› ì•Œë¦¼ -->
        <div class="guest-notice" id="guestNotice" style="display: none;">
            <span>ğŸ“Œ ë¹„íšŒì› ëª¨ë“œë¡œ ì‚¬ìš© ì¤‘ì…ë‹ˆë‹¤. ë°ì´í„°ëŠ” ì´ ê¸°ê¸°ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.</span>
            <button onclick="showAuthModal('login')">ë¡œê·¸ì¸í•˜ê¸°</button>
        </div>

        <!-- ìº˜ë¦°ë” í˜ì´ì§€ -->
        <div id="calendarPage" class="content-page active">
            <!-- ì›”ë³„ ìš”ì•½ -->
            <div class="summary-cards">
                <div class="summary-card">
                    <h3>ì´ë²ˆ ë‹¬ ìˆ˜ì…</h3>
                    <div class="amount income-amount" id="monthlyIncome">â‚©0</div>
                </div>
                <div class="summary-card">
                    <h3>ì´ë²ˆ ë‹¬ ì§€ì¶œ</h3>
                    <div class="amount expense-amount" id="monthlyExpense">â‚©0</div>
                </div>
                <div class="summary-card">
                    <h3>ì”ì•¡</h3>
                    <div class="amount balance-amount" id="monthlyBalance">â‚©0</div>
                </div>
            </div>

            <!-- ìº˜ë¦°ë” ë„¤ë¹„ê²Œì´ì…˜ -->
            <div class="calendar-nav">
                <button onclick="previousMonth()">â—€ ì´ì „</button>
                <h2 id="currentMonth">2024ë…„ 1ì›”</h2>
                <button onclick="nextMonth()">ë‹¤ìŒ â–¶</button>
            </div>

            <!-- ìº˜ë¦°ë” -->
            <div class="calendar-container">
                <div class="calendar-grid" id="calendarGrid">
                    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                </div>
            </div>
        </div>

        <!-- ê±°ë˜ ë‚´ì—­ í˜ì´ì§€ -->
        <div id="transactionsPage" class="content-page">
            <h2>ê±°ë˜ ë‚´ì—­</h2>
            <div class="transaction-list" id="transactionList">
                <p style="text-align: center; color: #666; padding: 20px;">ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
        </div>

        <!-- ê±°ë˜ ì¶”ê°€ í˜ì´ì§€ -->
        <div id="addTransactionPage" class="content-page">
            <h2>ê±°ë˜ ì¶”ê°€</h2>
            <form id="transactionForm" style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                <div class="form-group">
                    <label for="transactionType">ìœ í˜•</label>
                    <select id="transactionType" required onchange="updateCategoryOptions()">
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="EXPENSE">ì§€ì¶œ</option>
                        <option value="INCOME">ìˆ˜ì…</option>
                        <option value="ASSET">ìì‚° ì´ë™</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="amount">ê¸ˆì•¡</label>
                    <input type="number" id="amount" required min="0" step="1000" placeholder="0">
                </div>
                <div class="form-group">
                    <label for="category">ì¹´í…Œê³ ë¦¬</label>
                    <select id="category" required>
                        <option value="">ë¨¼ì € ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="transactionDate">ë‚ ì§œ</label>
                    <input type="date" id="transactionDate" required>
                </div>
                <div class="form-group">
                    <label for="description">ë©”ëª¨</label>
                    <textarea id="description" rows="3" placeholder="ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒì‚¬í•­)"></textarea>
                </div>
                <button type="submit" class="btn btn-block">ê±°ë˜ ì¶”ê°€</button>
            </form>
        </div>

        <!-- ì°¨íŠ¸ ë¶„ì„ í˜ì´ì§€ -->
        <div id="chartsPage" class="content-page">
            <h2>ì°¨íŠ¸ ë¶„ì„</h2>
            
            <!-- ê¸°ê°„ ì„ íƒ -->
            <div class="chart-container">
                <div class="chart-header">
                    <h3>ë¶„ì„ ê¸°ê°„</h3>
                    <div class="chart-filters">
                        <button class="filter-btn active" onclick="setChartPeriod('thisMonth', this)">ì´ë²ˆ ë‹¬</button>
                        <button class="filter-btn" onclick="setChartPeriod('lastMonth', this)">ì§€ë‚œ ë‹¬</button>
                        <button class="filter-btn" onclick="setChartPeriod('last3Months', this)">ìµœê·¼ 3ê°œì›”</button>
                        <button class="filter-btn" onclick="setChartPeriod('thisYear', this)">ì˜¬í•´</button>
                    </div>
                </div>
                
                <div class="summary-cards">
                    <div class="summary-card">
                        <h4>ì´ ìˆ˜ì…</h4>
                        <div class="amount income-amount" id="chartTotalIncome">â‚©0</div>
                    </div>
                    <div class="summary-card">
                        <h4>ì´ ì§€ì¶œ</h4>
                        <div class="amount expense-amount" id="chartTotalExpense">â‚©0</div>
                    </div>
                    <div class="summary-card">
                        <h4>ìˆœ ì”ì•¡</h4>
                        <div class="amount balance-amount" id="chartNetAmount">â‚©0</div>
                    </div>
                </div>
            </div>

            <!-- ì¹´í…Œê³ ë¦¬ë³„ ì§€ì¶œ ë¶„ì„ -->
            <div class="chart-container">
                <div class="chart-header">
                    <h3>ì¹´í…Œê³ ë¦¬ë³„ ì§€ì¶œ ë¶„ì„</h3>
                </div>
                <div id="categoryChart">
                    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                </div>
            </div>

            <!-- ì›”ë³„ íŠ¸ë Œë“œ -->
            <div class="chart-container">
                <div class="chart-header">
                    <h3>ì›”ë³„ ìˆ˜ì…/ì§€ì¶œ íŠ¸ë Œë“œ</h3>
                </div>
                <div id="monthlyTrend">
                    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                </div>
            </div>

            <!-- ì¼ë³„ ì§€ì¶œ íŒ¨í„´ -->
            <div class="chart-container">
                <div class="chart-header">
                    <h3>ìš”ì¼ë³„ ì§€ì¶œ íŒ¨í„´</h3>
                </div>
                <div id="weeklyPattern">
                    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                </div>
            </div>
        </div>

        <!-- ìì‚° ê´€ë¦¬ í˜ì´ì§€ -->
        <div id="assetsPage" class="content-page">
            <h2>ìì‚° ê´€ë¦¬</h2>
            
            <!-- ìì‚° ìš”ì•½ -->
            <div class="summary-cards">
                <div class="summary-card">
                    <h3>ì´ ìì‚°</h3>
                    <div class="amount balance-amount" id="totalAssets">â‚©0</div>
                </div>
                <div class="summary-card">
                    <h3>í˜„ê¸ˆì„± ìì‚°</h3>
                    <div class="amount income-amount" id="liquidAssets">â‚©0</div>
                </div>
                <div class="summary-card">
                    <h3>íˆ¬ì ìì‚°</h3>
                    <div class="amount" style="color: #9b59b6;" id="investmentAssets">â‚©0</div>
                </div>
                <div class="summary-card">
                    <h3>ë¶€ì±„</h3>
                    <div class="amount expense-amount" id="totalDebt">â‚©0</div>
                </div>
            </div>

            <!-- ìì‚° ëª©ë¡ -->
            <div style="background: white; padding: 30px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                <h3 style="margin-bottom: 20px;">ìì‚° í•­ëª©ë³„ í˜„í™©</h3>
                
                <div style="margin-bottom: 30px;">
                    <h4 style="color: #27ae60; margin-bottom: 15px;">ğŸ’° í˜„ê¸ˆì„± ìì‚°</h4>
                    <div id="cashAssets">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                    </div>
                </div>

                <div style="margin-bottom: 30px;">
                    <h4 style="color: #9b59b6; margin-bottom: 15px;">ğŸ“ˆ íˆ¬ì ìì‚°</h4>
                    <div id="investmentAssetsList">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                    </div>
                </div>

                <div>
                    <h4 style="color: #e74c3c; margin-bottom: 15px;">ğŸ’³ ë¶€ì±„</h4>
                    <div id="debtList">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                    </div>
                </div>
            </div>

            <!-- ìì‚° ë³€ë™ ì¶”ì´ -->
            <div style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                <h3 style="margin-bottom: 20px;">ìì‚° ë³€ë™ ì¶”ì´</h3>
                <div id="assetTrend">
                    <p style="text-align: center; color: #666; padding: 40px;">ìµœê·¼ 3ê°œì›”ê°„ ìì‚° ë³€ë™ì„ í‘œì‹œí•©ë‹ˆë‹¤.</p>
                </div>
            </div>
        </div>

        <!-- ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ í˜ì´ì§€ -->
        <div id="categoriesPage" class="content-page">
            <h2>ì¹´í…Œê³ ë¦¬ ê´€ë¦¬</h2>
            
            <!-- ì¹´í…Œê³ ë¦¬ ì¶”ê°€ í¼ -->
            <div style="background: white; padding: 30px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                <h3 style="margin-bottom: 20px;">ìƒˆ ì¹´í…Œê³ ë¦¬ ì¶”ê°€</h3>
                <form id="categoryForm">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div class="form-group">
                            <label for="categoryName">ì¹´í…Œê³ ë¦¬ ì´ë¦„</label>
                            <input type="text" id="categoryName" required placeholder="ì˜ˆ: ì¹´í˜">
                        </div>
                        <div class="form-group">
                            <label for="categoryType">ìœ í˜•</label>
                            <select id="categoryType" required>
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="EXPENSE">ì§€ì¶œ</option>
                                <option value="INCOME">ìˆ˜ì…</option>
                            </select>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div class="form-group">
                            <label for="categoryIcon">ì•„ì´ì½˜</label>
                            <select id="categoryIcon" required>
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="ğŸ½ï¸">ğŸ½ï¸ ìŒì‹</option>
                                <option value="ğŸš—">ğŸš— êµí†µ</option>
                                <option value="ğŸ›’">ğŸ›’ ì‡¼í•‘</option>
                                <option value="ğŸ¥">ğŸ¥ ì˜ë£Œ</option>
                                <option value="ğŸ¬">ğŸ¬ ë¬¸í™”</option>
                                <option value="ğŸ ">ğŸ  ì£¼ê±°</option>
                                <option value="ğŸ“š">ğŸ“š êµìœ¡</option>
                                <option value="ğŸ‘•">ğŸ‘• ì˜ë¥˜</option>
                                <option value="ğŸ“±">ğŸ“± í†µì‹ </option>
                                <option value="âš¡">âš¡ ê³µê³¼ê¸ˆ</option>
                                <option value="ğŸ’¼">ğŸ’¼ ì—…ë¬´</option>
                                <option value="ğŸ’µ">ğŸ’µ ìš©ëˆ</option>
                                <option value="ğŸ“Š">ğŸ“Š íˆ¬ì</option>
                                <option value="ğŸ">ğŸ ì„ ë¬¼</option>
                                <option value="â˜•">â˜• ì¹´í˜</option>
                                <option value="ğŸšŒ">ğŸšŒ ëŒ€ì¤‘êµí†µ</option>
                                <option value="â›½">â›½ ì£¼ìœ </option>
                                <option value="ğŸ’„">ğŸ’„ ë¯¸ìš©</option>
                                <option value="ğŸ‹ï¸">ğŸ‹ï¸ ìš´ë™</option>
                                <option value="ğŸ“">ğŸ“ ê¸°íƒ€</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="categoryColor">ìƒ‰ìƒ</label>
                            <select id="categoryColor" required>
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="#FF6B6B" style="background: #FF6B6B; color: white;">ğŸ”´ ë¹¨ê°„ìƒ‰</option>
                                <option value="#4ECDC4" style="background: #4ECDC4; color: white;">ğŸŸ¢ ë¯¼íŠ¸</option>
                                <option value="#45B7D1" style="background: #45B7D1; color: white;">ğŸ”µ íŒŒë€ìƒ‰</option>
                                <option value="#96CEB4" style="background: #96CEB4; color: white;">ğŸŸ¢ ì—°ë‘ìƒ‰</option>
                                <option value="#FFEAA7" style="background: #FFEAA7; color: black;">ğŸŸ¡ ë…¸ë€ìƒ‰</option>
                                <option value="#FF7675" style="background: #FF7675; color: white;">ğŸŸ  ì£¼í™©ìƒ‰</option>
                                <option value="#6C5CE7" style="background: #6C5CE7; color: white;">ğŸŸ£ ë³´ë¼ìƒ‰</option>
                                <option value="#FD79A8" style="background: #FD79A8; color: white;">ğŸ©· ë¶„í™ìƒ‰</option>
                                <option value="#00B894" style="background: #00B894; color: white;">ğŸŸ¢ ì´ˆë¡ìƒ‰</option>
                                <option value="#FDCB6E" style="background: #FDCB6E; color: black;">ğŸŸ¨ ê³¨ë“œ</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-block">ì¹´í…Œê³ ë¦¬ ì¶”ê°€</button>
                </form>
            </div>

            <!-- ì¹´í…Œê³ ë¦¬ ëª©ë¡ -->
            <div style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                <h3 style="margin-bottom: 20px;">ë‚´ ì¹´í…Œê³ ë¦¬</h3>
                
                <!-- ì§€ì¶œ ì¹´í…Œê³ ë¦¬ -->
                <div style="margin-bottom: 30px;">
                    <h4 style="color: #e74c3c; margin-bottom: 15px;">ğŸ’³ ì§€ì¶œ ì¹´í…Œê³ ë¦¬</h4>
                    <div id="expenseCategories" class="category-grid">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                    </div>
                </div>

                <!-- ìˆ˜ì… ì¹´í…Œê³ ë¦¬ -->
                <div>
                    <h4 style="color: #27ae60; margin-bottom: 15px;">ğŸ’° ìˆ˜ì… ì¹´í…Œê³ ë¦¬</h4>
                    <div id="incomeCategories" class="category-grid">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                    </div>
                </div>
            </div>
        </div>

        <!-- ì„¤ì • í˜ì´ì§€ -->
        <div id="settingsPage" class="content-page">
            <h2>ì„¤ì •</h2>
            
            <!-- ì‚¬ìš©ì ì •ë³´ -->
            <div style="background: white; padding: 30px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                <h3 style="margin-bottom: 20px;">ì‚¬ìš©ì ì •ë³´</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label>ì´ë¦„</label>
                        <input type="text" id="settingsName" readonly style="background: #f8f9fa;">
                    </div>
                    <div class="form-group">
                        <label>ì´ë©”ì¼</label>
                        <input type="email" id="settingsEmail" readonly style="background: #f8f9fa;">
                    </div>
                </div>
            </div>

            <!-- í™”í ì„¤ì • -->
            <div style="background: white; padding: 30px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                <h3 style="margin-bottom: 20px;">í™”í ì„¤ì •</h3>
                <div class="form-group">
                    <label for="currency">ê¸°ë³¸ í™”í</label>
                    <select id="currency">
                        <option value="KRW">ì› (â‚©)</option>
                        <option value="USD">ë‹¬ëŸ¬ ($)</option>
                        <option value="EUR">ìœ ë¡œ (â‚¬)</option>
                        <option value="JPY">ì—” (Â¥)</option>
                    </select>
                </div>
            </div>

            <!-- ì•Œë¦¼ ì„¤ì • -->
            <div style="background: white; padding: 30px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                <h3 style="margin-bottom: 20px;">ì•Œë¦¼ ì„¤ì •</h3>
                <div style="display: grid; gap: 15px;">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="dailyNotification">
                        <span>ì¼ì¼ ì§€ì¶œ ìš”ì•½ ì•Œë¦¼</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="budgetAlert">
                        <span>ì˜ˆì‚° ì´ˆê³¼ ê²½ê³ </span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="weeklyReport">
                        <span>ì£¼ê°„ ë¦¬í¬íŠ¸</span>
                    </label>
                </div>
            </div>

            <!-- ë°ì´í„° ê´€ë¦¬ -->
            <div style="background: white; padding: 30px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                <h3 style="margin-bottom: 20px;">ë°ì´í„° ê´€ë¦¬</h3>
                <div style="display: grid; gap: 15px;">
                    <button class="btn" onclick="exportData()" style="background: #27ae60;">
                        ğŸ“Š ë°ì´í„° ë‚´ë³´ë‚´ê¸° (CSV)
                    </button>
                    <button class="btn" onclick="showImportData()" style="background: #3498db;">
                        ğŸ“¥ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                    </button>
                    <button class="btn" onclick="clearAllData()" style="background: #e74c3c;">
                        ğŸ—‘ï¸ ëª¨ë“  ë°ì´í„° ì‚­ì œ
                    </button>
                </div>
            </div>

            <!-- ì•± ì •ë³´ -->
            <div style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                <h3 style="margin-bottom: 20px;">ì•± ì •ë³´</h3>
                <div style="color: #666; line-height: 1.6;">
                    <p><strong>Unble Budget</strong> v1.0.0</p>
                    <p>ê°œì¸ ê°€ê³„ë¶€ ê´€ë¦¬ ì„œë¹„ìŠ¤</p>
                    <p>ë¬¸ì˜: kimdan2@nate.com</p>
                </div>
            </div>
        </div>
    </main>

    <!-- ì¸ì¦ ëª¨ë‹¬ -->
    <div id="authModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="authTitle">ë¡œê·¸ì¸</h3>
                <button class="close-btn" onclick="closeAuthModal()">&times;</button>
            </div>
            
            <!-- ë¡œê·¸ì¸ í¼ -->
            <form id="loginForm" style="display: none;">
                <div class="form-group">
                    <label for="loginEmail">ì´ë©”ì¼</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="btn btn-block">ë¡œê·¸ì¸</button>
                <p style="text-align: center; margin-top: 20px;">
                    ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? 
                    <a href="#" onclick="showAuthModal('register'); return false;" style="color: #667eea;">íšŒì›ê°€ì…</a>
                </p>
            </form>

            <!-- íšŒì›ê°€ì… í¼ -->
            <form id="registerForm" style="display: none;">
                <div class="form-group">
                    <label for="registerName">ì´ë¦„</label>
                    <input type="text" id="registerName" required>
                </div>
                <div class="form-group">
                    <label for="registerEmail">ì´ë©”ì¼</label>
                    <input type="email" id="registerEmail" required>
                </div>
                <div class="form-group">
                    <label for="registerPassword">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="registerPassword" required minlength="4">
                    <small style="color: #666; font-size: 12px;">ìµœì†Œ 4ì ì´ìƒ</small>
                </div>
                <div class="form-group">
                    <label for="registerPasswordConfirm">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                    <input type="password" id="registerPasswordConfirm" required minlength="4">
                    <small id="passwordError" style="color: #e74c3c; font-size: 12px; display: none;">ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</small>
                </div>
                <button type="submit" class="btn btn-block">íšŒì›ê°€ì…</button>
                <p style="text-align: center; margin-top: 20px;">
                    ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? 
                    <a href="#" onclick="showAuthModal('login'); return false;" style="color: #667eea;">ë¡œê·¸ì¸</a>
                </p>
            </form>
        </div>
    </div>

    <!-- ì¼ë³„ ìƒì„¸ ëª¨ë‹¬ -->
    <div id="dayModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalDate">2024ë…„ 1ì›” 1ì¼</h3>
                <button class="close-btn" onclick="closeDayModal()">&times;</button>
            </div>
            
            <div class="summary-cards" style="margin-bottom: 20px;">
                <div class="summary-card">
                    <h4>ìˆ˜ì…</h4>
                    <div class="amount income-amount" id="modalIncome">â‚©0</div>
                </div>
                <div class="summary-card">
                    <h4>ì§€ì¶œ</h4>
                    <div class="amount expense-amount" id="modalExpense">â‚©0</div>
                </div>
            </div>

            <div id="modalTransactions">
                <!-- ê±°ë˜ ë‚´ì—­ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
            </div>

            <button class="btn btn-block" style="margin-top: 20px;" onclick="addTransactionForDate()">ì´ ë‚ ì§œì— ê±°ë˜ ì¶”ê°€</button>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        const API_BASE = '/api';
        let authToken = localStorage.getItem('authToken');
        let isGuest = !authToken;
        let currentDate = new Date();
        let selectedDate = null;
        let transactions = [];
        let categories = {
            EXPENSE: [
                { id: 'food', name: 'ì‹ë¹„', icon: 'ğŸ½ï¸' },
                { id: 'transport', name: 'êµí†µë¹„', icon: 'ğŸš—' },
                { id: 'shopping', name: 'ì‡¼í•‘', icon: 'ğŸ›’' },
                { id: 'health', name: 'ì˜ë£Œë¹„', icon: 'ğŸ¥' },
                { id: 'culture', name: 'ë¬¸í™”/ì—¬ê°€', icon: 'ğŸ¬' },
                { id: 'housing', name: 'ì£¼ê±°ë¹„', icon: 'ğŸ ' },
                { id: 'education', name: 'êµìœ¡ë¹„', icon: 'ğŸ“š' },
                { id: 'etc', name: 'ê¸°íƒ€', icon: 'ğŸ“' }
            ],
            INCOME: [
                { id: 'salary', name: 'ê¸‰ì—¬', icon: 'ğŸ’¼' },
                { id: 'bonus', name: 'ë³´ë„ˆìŠ¤', icon: 'ğŸ’µ' },
                { id: 'investment', name: 'íˆ¬ììˆ˜ìµ', icon: 'ğŸ“Š' },
                { id: 'gift', name: 'ì„ ë¬¼/ìš©ëˆ', icon: 'ğŸ' },
                { id: 'etc', name: 'ê¸°íƒ€', icon: 'ğŸ“' }
            ],
            ASSET: [
                { id: 'cash', name: 'í˜„ê¸ˆ', icon: 'ğŸ’°' },
                { id: 'bank', name: 'ì€í–‰ì˜ˆê¸ˆ', icon: 'ğŸ¦' },
                { id: 'savings', name: 'ì ê¸ˆ', icon: 'ğŸ’' },
                { id: 'investment', name: 'íˆ¬ì', icon: 'ğŸ“ˆ' },
                { id: 'card', name: 'ì¹´ë“œì”ì•¡', icon: 'ğŸ’³' }
            ]
        };

        // ì´ˆê¸°í™”
        window.onload = function() {
            initializeApp();
            setToday();
            renderCalendar();
            loadData();
        };

        // ì•± ì´ˆê¸°í™”
        function initializeApp() {
            if (isGuest) {
                document.getElementById('guestNotice').style.display = 'flex';
                document.getElementById('authSection').style.display = 'flex';
                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„° ë¡œë“œ
                loadLocalData();
            } else {
                updateAuthUI();
                // ì„œë²„ì—ì„œ ë°ì´í„° ë¡œë“œ
                loadServerData();
            }
        }

        // ì¸ì¦ UI ì—…ë°ì´íŠ¸
        function updateAuthUI() {
            const authSection = document.getElementById('authSection');
            const userName = localStorage.getItem('userName') || 'ì‚¬ìš©ì';
            authSection.innerHTML = `
                <span style="margin-right: 10px;">${userName}</span>
                <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
            `;
            document.getElementById('guestNotice').style.display = 'none';
        }

        // ì‚¬ì´ë“œë°” í† ê¸€
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        }

        // í˜ì´ì§€ ì „í™˜
        function showPage(pageId, element) {
            // ëª¨ë“  í˜ì´ì§€ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.content-page').forEach(page => {
                page.classList.remove('active');
            });
            
            // ì„ íƒí•œ í˜ì´ì§€ í‘œì‹œ
            document.getElementById(pageId + 'Page').classList.add('active');
            
            // ë„¤ë¹„ê²Œì´ì…˜ ì•„ì´í…œ í™œì„±í™”
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            if (element) {
                element.classList.add('active');
            }
            
            // í˜ì´ì§€ë³„ ë°ì´í„° ì—…ë°ì´íŠ¸
            switch(pageId) {
                case 'charts':
                    updateChartData();
                    break;
                case 'assets':
                    updateAssetData();
                    break;
                case 'settings':
                    loadSettings();
                    break;
                case 'categories':
                    updateCategoryDisplay();
                    break;
            }
            
            // ì‚¬ì´ë“œë°” ë‹«ê¸°
            toggleSidebar();
        }

        // ìº˜ë¦°ë” ë Œë”ë§
        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            document.getElementById('currentMonth').textContent = 
                `${year}ë…„ ${month + 1}ì›”`;
            
            const calendarGrid = document.getElementById('calendarGrid');
            calendarGrid.innerHTML = '';
            
            // ìš”ì¼ í—¤ë”
            const weekdays = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            weekdays.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-header';
                header.textContent = day;
                calendarGrid.appendChild(header);
            });
            
            // ë‚ ì§œ ê³„ì‚°
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const prevLastDay = new Date(year, month, 0);
            
            const firstDayOfWeek = firstDay.getDay();
            const totalDays = lastDay.getDate();
            const prevTotalDays = prevLastDay.getDate();
            
            // ì´ì „ ë‹¬ ë‚ ì§œ
            for (let i = firstDayOfWeek - 1; i >= 0; i--) {
                const day = prevTotalDays - i;
                const dayElement = createDayElement(new Date(year, month - 1, day), true);
                calendarGrid.appendChild(dayElement);
            }
            
            // ì´ë²ˆ ë‹¬ ë‚ ì§œ
            for (let day = 1; day <= totalDays; day++) {
                const date = new Date(year, month, day);
                const dayElement = createDayElement(date, false);
                calendarGrid.appendChild(dayElement);
            }
            
            // ë‹¤ìŒ ë‹¬ ë‚ ì§œ
            const remainingCells = 42 - (firstDayOfWeek + totalDays);
            for (let day = 1; day <= remainingCells; day++) {
                const dayElement = createDayElement(new Date(year, month + 1, day), true);
                calendarGrid.appendChild(dayElement);
            }
            
            updateCalendarData();
        }

        // ë‚ ì§œ ìš”ì†Œ ìƒì„±
        function createDayElement(date, isOtherMonth) {
            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day';
            
            if (isOtherMonth) {
                dayElement.classList.add('other-month');
            }
            
            const today = new Date();
            if (date.toDateString() === today.toDateString()) {
                dayElement.classList.add('today');
            }
            
            const dayNumber = document.createElement('div');
            dayNumber.className = 'day-number';
            dayNumber.textContent = date.getDate();
            dayElement.appendChild(dayNumber);
            
            const daySummary = document.createElement('div');
            daySummary.className = 'day-summary';
            daySummary.id = `summary-${date.toISOString().split('T')[0]}`;
            dayElement.appendChild(daySummary);
            
            if (!isOtherMonth) {
                dayElement.addEventListener('click', () => showDayDetail(date));
            }
            
            return dayElement;
        }

        // ìº˜ë¦°ë” ë°ì´í„° ì—…ë°ì´íŠ¸
        function updateCalendarData() {
            const currentYear = currentDate.getFullYear();
            const currentMonth = currentDate.getMonth();
            
            const monthlyIncome = { total: 0 };
            const monthlyExpense = { total: 0 };
            const dailyData = {};
            
            console.log('í˜„ì¬ í‘œì‹œ ì¤‘ì¸ ì›”:', currentYear, currentMonth + 1);
            console.log('ì „ì²´ ê±°ë˜ ë‚´ì—­:', transactions);
            
            transactions.forEach(transaction => {
                // ë‚ ì§œ ë¬¸ìì—´ì„ ì§ì ‘ íŒŒì‹± (ì‹œê°„ëŒ€ ë¬¸ì œ í•´ê²°)
                const dateParts = transaction.transactionDate.split('-');
                const transactionYear = parseInt(dateParts[0]);
                const transactionMonth = parseInt(dateParts[1]) - 1; // JavaScriptì—ì„œëŠ” ì›”ì´ 0ë¶€í„° ì‹œì‘
                
                const date = transaction.transactionDate;
                if (!dailyData[date]) {
                    dailyData[date] = { income: 0, expense: 0 };
                }
                
                const amount = parseFloat(transaction.amount) || 0;
                
                if (transaction.transactionType === 'INCOME') {
                    dailyData[date].income += amount;
                    
                    // í˜„ì¬ í‘œì‹œ ì¤‘ì¸ ì›”ê³¼ ê°™ì€ ê²½ìš°ë§Œ ì›”ë³„ í•©ê³„ì— í¬í•¨
                    if (transactionYear === currentYear && transactionMonth === currentMonth) {
                        monthlyIncome.total += amount;
                    }
                } else if (transaction.transactionType === 'EXPENSE') {
                    dailyData[date].expense += amount;
                    
                    // í˜„ì¬ í‘œì‹œ ì¤‘ì¸ ì›”ê³¼ ê°™ì€ ê²½ìš°ë§Œ ì›”ë³„ í•©ê³„ì— í¬í•¨
                    if (transactionYear === currentYear && transactionMonth === currentMonth) {
                        monthlyExpense.total += amount;
                    }
                }
            });
            
            console.log('ì›”ë³„ ìˆ˜ì…:', monthlyIncome.total);
            console.log('ì›”ë³„ ì§€ì¶œ:', monthlyExpense.total);
            
            // ì›”ë³„ ìš”ì•½ ì—…ë°ì´íŠ¸
            document.getElementById('monthlyIncome').textContent = `â‚©${monthlyIncome.total.toLocaleString()}`;
            document.getElementById('monthlyExpense').textContent = `â‚©${monthlyExpense.total.toLocaleString()}`;
            document.getElementById('monthlyBalance').textContent = `â‚©${(monthlyIncome.total - monthlyExpense.total).toLocaleString()}`;
            
            // ì¼ë³„ ë°ì´í„° í‘œì‹œ (í˜„ì¬ ì›”ì— í•´ë‹¹í•˜ëŠ” ë‚ ì§œë§Œ)
            Object.keys(dailyData).forEach(date => {
                const dateParts = date.split('-');
                const dataYear = parseInt(dateParts[0]);
                const dataMonth = parseInt(dateParts[1]) - 1;
                
                // í˜„ì¬ í‘œì‹œ ì¤‘ì¸ ì›”ì˜ ë°ì´í„°ë§Œ ìº˜ë¦°ë”ì— í‘œì‹œ
                if (dataYear === currentYear && dataMonth === currentMonth) {
                    const summaryElement = document.getElementById(`summary-${date}`);
                    if (summaryElement) {
                        const data = dailyData[date];
                        const net = data.income - data.expense;
                        
                        summaryElement.innerHTML = `
                            ${data.income > 0 ? `<div class="income-amount">+${data.income.toLocaleString()}</div>` : ''}
                            ${data.expense > 0 ? `<div class="expense-amount">-${data.expense.toLocaleString()}</div>` : ''}
                        `;
                        
                        const dayElement = summaryElement.parentElement;
                        dayElement.classList.remove('net-positive', 'net-negative');
                        if (net > 0) {
                            dayElement.classList.add('net-positive');
                        } else if (net < 0) {
                            dayElement.classList.add('net-negative');
                        }
                    }
                }
            });
        }

        // ë°ì´í„° ë¡œë“œ
        function loadData() {
            if (isGuest) {
                loadLocalData();
            } else {
                loadServerData();
            }
        }

        // ë¡œì»¬ ë°ì´í„° ë¡œë“œ
        function loadLocalData() {
            const savedTransactions = localStorage.getItem('guestTransactions');
            if (savedTransactions) {
                transactions = JSON.parse(savedTransactions);
            }
            
            const savedCategories = localStorage.getItem('guestCategories');
            if (savedCategories) {
                const localCategories = JSON.parse(savedCategories);
                categories.EXPENSE = localCategories.EXPENSE || categories.EXPENSE;
                categories.INCOME = localCategories.INCOME || categories.INCOME;
                categories.ASSET = localCategories.ASSET || categories.ASSET;
            }
            
            updateCalendarData();
            updateTransactionList();
            updateCategoryDisplay();
        }

        // ê²ŒìŠ¤íŠ¸ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜
        async function migrateGuestData(guestTransactions) {
            try {
                // ë°ì´í„° ê²€ì¦
                const validateResponse = await fetch(`${API_BASE}/migration/validate-data`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(guestTransactions)
                });

                const validateResult = await validateResponse.json();
                
                if (!validateResult.canMigrate) {
                    alert(`ë°ì´í„° ê²€ì¦ ì‹¤íŒ¨: ${validateResult.invalidCount}ê°œì˜ ìœ íš¨í•˜ì§€ ì•Šì€ ë°ì´í„°ê°€ ìˆìŠµë‹ˆë‹¤.`);
                    return;
                }

                // ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
                const migrateResponse = await fetch(`${API_BASE}/migration/guest-data`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(guestTransactions)
                });

                const migrateResult = await migrateResponse.json();
                
                if (migrateResult.success) {
                    alert(`ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ!\nì„±ê³µ: ${migrateResult.successCount}ê°œ\nì‹¤íŒ¨: ${migrateResult.failCount}ê°œ`);
                } else {
                    alert('ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ë§ˆì´ê·¸ë ˆì´ì…˜ ì˜¤ë¥˜:', error);
                alert('ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì„œë²„ ë°ì´í„° ë¡œë“œ
        async function loadServerData() {
            try {
                // ë¨¼ì € ì¹´í…Œê³ ë¦¬ ë¡œë“œ
                const categoryResponse = await fetch(`${API_BASE}/categories`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (categoryResponse.ok) {
                    const serverCategories = await categoryResponse.json();
                    // ì„œë²„ ì¹´í…Œê³ ë¦¬ë¡œ ì—…ë°ì´íŠ¸
                    categories.EXPENSE = serverCategories.filter(c => c.categoryType === 'EXPENSE');
                    categories.INCOME = serverCategories.filter(c => c.categoryType === 'INCOME');
                    categories.ASSET = serverCategories.filter(c => c.categoryType === 'ASSET');
                }
                
                // ê±°ë˜ ë‚´ì—­ ë¡œë“œ
                const response = await fetch(`${API_BASE}/transactions`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    transactions = await response.json();
                    updateCalendarData();
                    updateTransactionList();
                    updateCategoryDisplay();
                }
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // ê±°ë˜ ì¶”ê°€
        document.getElementById('transactionForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = {
                transactionType: document.getElementById('transactionType').value,
                amount: parseInt(document.getElementById('amount').value),
                category: document.getElementById('category').value,
                transactionDate: document.getElementById('transactionDate').value,
                description: document.getElementById('description').value
            };
            
            if (isGuest) {
                // ë¹„íšŒì›ì€ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ë§Œ ì €ì¥
                const newTransaction = {
                    ...formData,
                    id: Date.now(),
                    category: categories[formData.transactionType].find(c => c.id === formData.category)
                };
                transactions.push(newTransaction);
                localStorage.setItem('guestTransactions', JSON.stringify(transactions));
                
                alert('ê±°ë˜ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤! (ë¡œì»¬ ì €ì¥)');
                document.getElementById('transactionForm').reset();
                setToday();
                loadData();
                showPage('calendar', document.querySelector('.nav-item[onclick*="calendar"]'));
            } else {
                // íšŒì›ì€ ì„œë²„ DBì— ì €ì¥ (ê³„ì •ë³„ë¡œ ë¶„ë¦¬)
                try {
                    console.log('ê±°ë˜ ì¶”ê°€ ìš”ì²­ ë°ì´í„°:', formData);
                    console.log('ì‚¬ìš© ê°€ëŠ¥í•œ ì¹´í…Œê³ ë¦¬:', categories);
                    
                    // ì¹´í…Œê³ ë¦¬ ID ì°¾ê¸°
                    let categoryId = null;
                    if (formData.category) {
                        const selectedCategory = categories[formData.transactionType]?.find(c => 
                            c.id.toString() === formData.category.toString()
                        );
                        categoryId = selectedCategory ? selectedCategory.id : null;
                        console.log('ì„ íƒëœ ì¹´í…Œê³ ë¦¬:', selectedCategory);
                    }
                    
                    const serverData = {
                        transactionType: formData.transactionType,
                        amount: formData.amount,
                        categoryId: categoryId,
                        transactionDate: formData.transactionDate,
                        description: formData.description || ''
                    };
                    
                    console.log('ì„œë²„ë¡œ ì „ì†¡í•  ë°ì´í„°:', serverData);
                    
                    const response = await fetch(`${API_BASE}/transactions`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${authToken}`
                        },
                        body: JSON.stringify(serverData)
                    });
                    
                    console.log('ì„œë²„ ì‘ë‹µ ìƒíƒœ:', response.status);
                    
                    const responseData = await response.json();
                    console.log('ì„œë²„ ì‘ë‹µ ë°ì´í„°:', responseData);
                    
                    if (response.ok) {
                        alert('ê±°ë˜ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
                        document.getElementById('transactionForm').reset();
                        setToday();
                        await loadData();
                        showPage('calendar', document.querySelector('.nav-item[onclick*="calendar"]'));
                    } else {
                        alert('ì„œë²„ ì˜¤ë¥˜: ' + (responseData.message || 'ê±°ë˜ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'));
                    }
                } catch (error) {
                    console.error('ê±°ë˜ ì¶”ê°€ ì˜¤ë¥˜:', error);
                    
                    // ì—ëŸ¬ ë©”ì‹œì§€ ê°œì„ 
                    let errorMessage = 'ê±°ë˜ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                    if (error.message) {
                        if (error.message.includes('Cannot read properties of undefined')) {
                            errorMessage = 'í¼ ë°ì´í„° ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                        } else if (error.message.includes('Failed to fetch')) {
                            errorMessage = 'ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
                        } else {
                            errorMessage = 'ì˜¤ë¥˜: ' + error.message;
                        }
                    }
                    
                    alert(errorMessage);
                }
            }
        });

        // ì¹´í…Œê³ ë¦¬ ì˜µì…˜ ì—…ë°ì´íŠ¸
        function updateCategoryOptions() {
            const type = document.getElementById('transactionType').value;
            const categorySelect = document.getElementById('category');
            
            categorySelect.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
            
            if (type && categories[type]) {
                categories[type].forEach(category => {
                    const option = document.createElement('option');
                    // ë¹„íšŒì›: id ë¬¸ìì—´, íšŒì›: ì„œë²„ ID ìˆ«ì
                    option.value = isGuest ? category.id : category.id.toString();
                    option.textContent = `${category.icon || ''} ${category.name}`;
                    categorySelect.appendChild(option);
                });
            }
        }

        // ê±°ë˜ ë‚´ì—­ ì—…ë°ì´íŠ¸
        function updateTransactionList() {
            const transactionList = document.getElementById('transactionList');
            
            if (transactions.length === 0) {
                transactionList.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            const sortedTransactions = [...transactions].sort((a, b) => 
                new Date(b.transactionDate) - new Date(a.transactionDate)
            );
            
            transactionList.innerHTML = sortedTransactions.map(transaction => {
                const category = transaction.category || { name: 'ê¸°íƒ€', icon: 'ğŸ“' };
                const amountClass = transaction.transactionType === 'EXPENSE' ? 'expense-amount' : 'income-amount';
                const amountSign = transaction.transactionType === 'EXPENSE' ? '-' : '+';
                
                return `
                    <div class="transaction-item">
                        <div>
                            <strong>${category.icon} ${category.name}</strong>
                            <div style="color: #666; font-size: 0.9em;">
                                ${transaction.description || 'ë©”ëª¨ ì—†ìŒ'} â€¢ ${transaction.transactionDate}
                            </div>
                        </div>
                        <div class="${amountClass}" style="font-weight: 600;">
                            ${amountSign}â‚©${transaction.amount.toLocaleString()}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ì¼ë³„ ìƒì„¸ ë³´ê¸°
        function showDayDetail(date) {
            selectedDate = date;
            // ë¡œì»¬ ì‹œê°„ëŒ€ë¡œ ë‚ ì§œ í¬ë§·íŒ…
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const dateStr = `${year}-${month}-${day}`;
            
            console.log('ì„ íƒëœ ë‚ ì§œ:', dateStr);
            console.log('í•´ë‹¹ ë‚ ì§œ ê±°ë˜ ì°¾ëŠ” ì¤‘...');
            
            const dayTransactions = transactions.filter(t => {
                console.log('ê±°ë˜ ë‚ ì§œ:', t.transactionDate, 'ë¹„êµ:', dateStr, 'ì¼ì¹˜:', t.transactionDate === dateStr);
                return t.transactionDate === dateStr;
            });
            const dayIncome = dayTransactions.filter(t => t.transactionType === 'INCOME')
                .reduce((sum, t) => sum + parseFloat(t.amount), 0);
            const dayExpense = dayTransactions.filter(t => t.transactionType === 'EXPENSE')
                .reduce((sum, t) => sum + parseFloat(t.amount), 0);
            
            document.getElementById('modalDate').textContent = 
                `${date.getFullYear()}ë…„ ${date.getMonth() + 1}ì›” ${date.getDate()}ì¼`;
            document.getElementById('modalIncome').textContent = `â‚©${dayIncome.toLocaleString()}`;
            document.getElementById('modalExpense').textContent = `â‚©${dayExpense.toLocaleString()}`;
            
            const modalTransactions = document.getElementById('modalTransactions');
            if (dayTransactions.length === 0) {
                modalTransactions.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            } else {
                modalTransactions.innerHTML = '<h4 style="margin-bottom: 15px;">ê±°ë˜ ë‚´ì—­</h4>' + 
                    dayTransactions.map(transaction => {
                        const category = transaction.category || { name: 'ê¸°íƒ€', icon: 'ğŸ“' };
                        const amountClass = transaction.transactionType === 'EXPENSE' ? 'expense-amount' : 'income-amount';
                        const amountSign = transaction.transactionType === 'EXPENSE' ? '-' : '+';
                        
                        return `
                            <div class="transaction-item">
                                <div>
                                    <strong>${category.icon} ${category.name}</strong>
                                    <div style="color: #666; font-size: 0.9em;">
                                        ${transaction.description || 'ë©”ëª¨ ì—†ìŒ'}
                                    </div>
                                </div>
                                <div class="${amountClass}" style="font-weight: 600;">
                                    ${amountSign}â‚©${transaction.amount.toLocaleString()}
                                </div>
                            </div>
                        `;
                    }).join('');
            }
            
            document.getElementById('dayModal').classList.add('active');
        }

        // ì„ íƒí•œ ë‚ ì§œì— ê±°ë˜ ì¶”ê°€
        function addTransactionForDate() {
            if (selectedDate) {
                // ë¡œì»¬ ì‹œê°„ëŒ€ë¡œ ë‚ ì§œ í¬ë§·íŒ…
                const year = selectedDate.getFullYear();
                const month = String(selectedDate.getMonth() + 1).padStart(2, '0');
                const day = String(selectedDate.getDate()).padStart(2, '0');
                const dateStr = `${year}-${month}-${day}`;
                
                document.getElementById('transactionDate').value = dateStr;
                closeDayModal();
                showPage('addTransaction', document.querySelector('.nav-item[onclick*=\"addTransaction\"]'));
            }
        }

        // ì¸ì¦ ëª¨ë‹¬
        function showAuthModal(type) {
            const modal = document.getElementById('authModal');
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            const title = document.getElementById('authTitle');
            
            if (type === 'login') {
                title.textContent = 'ë¡œê·¸ì¸';
                loginForm.style.display = 'block';
                registerForm.style.display = 'none';
            } else {
                title.textContent = 'íšŒì›ê°€ì…';
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
            }
            
            modal.classList.add('active');
        }

        function closeAuthModal() {
            document.getElementById('authModal').classList.remove('active');
        }

        function closeDayModal() {
            document.getElementById('dayModal').classList.remove('active');
        }

        // ë¡œê·¸ì¸
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (response.ok && data.token) {
                    authToken = data.token;
                    isGuest = false;
                    localStorage.setItem('authToken', authToken);
                    localStorage.setItem('userName', data.name);
                    
                    // ê²ŒìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ì„œë²„ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í• ì§€ í™•ì¸
                    const guestTransactions = localStorage.getItem('guestTransactions');
                    if (guestTransactions) {
                        if (confirm('ë¹„íšŒì›ìœ¼ë¡œ ì‘ì„±í•œ ë°ì´í„°ë¥¼ ê³„ì •ìœ¼ë¡œ ì´ì „í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                            await migrateGuestData(JSON.parse(guestTransactions));
                        }
                        localStorage.removeItem('guestTransactions');
                    }
                    
                    closeAuthModal();
                    updateAuthUI();
                    loadServerData();
                } else {
                    alert(data.message || 'ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                alert('ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        });

        // íšŒì›ê°€ì…
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const passwordConfirm = document.getElementById('registerPasswordConfirm').value;
            
            // ë¹„ë°€ë²ˆí˜¸ í™•ì¸
            if (password !== passwordConfirm) {
                document.getElementById('passwordError').style.display = 'block';
                document.getElementById('registerPasswordConfirm').focus();
                return;
            }
            
            document.getElementById('passwordError').style.display = 'none';
            
            try {
                const response = await fetch(`${API_BASE}/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ name, email, password })
                });
                
                const data = await response.json();
                
                if (response.ok && data.token) {
                    authToken = data.token;
                    isGuest = false;
                    localStorage.setItem('authToken', authToken);
                    localStorage.setItem('userName', data.name);
                    
                    closeAuthModal();
                    updateAuthUI();
                    loadServerData();
                } else {
                    alert(data.message || 'íšŒì›ê°€ì…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                alert('íšŒì›ê°€ì… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        });

        // ë¡œê·¸ì•„ì›ƒ
        function logout() {
            authToken = null;
            isGuest = true;
            localStorage.removeItem('authToken');
            localStorage.removeItem('userName');
            transactions = [];
            
            document.getElementById('authSection').innerHTML = `
                <button class="auth-btn" onclick="showAuthModal('login')">ë¡œê·¸ì¸</button>
                <button class="auth-btn" onclick="showAuthModal('register')">íšŒì›ê°€ì…</button>
            `;
            document.getElementById('guestNotice').style.display = 'flex';
            
            loadLocalData();
        }

        // ì›” ì´ë™
        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        }

        // ì˜¤ëŠ˜ ë‚ ì§œ ì„¤ì •
        function setToday() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            const dateStr = `${year}-${month}-${day}`;
            document.getElementById('transactionDate').value = dateStr;
        }
        
        // ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì‹¤ì‹œê°„ ê²€ì¦
        document.getElementById('registerPasswordConfirm').addEventListener('input', function() {
            const password = document.getElementById('registerPassword').value;
            const passwordConfirm = this.value;
            const errorElement = document.getElementById('passwordError');
            
            if (passwordConfirm && password !== passwordConfirm) {
                errorElement.style.display = 'block';
                this.style.borderColor = '#e74c3c';
            } else {
                errorElement.style.display = 'none';
                this.style.borderColor = passwordConfirm ? '#27ae60' : '#eee';
            }
        });
        
        // ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì‹œì—ë„ í™•ì¸
        document.getElementById('registerPassword').addEventListener('input', function() {
            const passwordConfirm = document.getElementById('registerPasswordConfirm').value;
            if (passwordConfirm) {
                document.getElementById('registerPasswordConfirm').dispatchEvent(new Event('input'));
            }
        });

        // ì¹´í…Œê³ ë¦¬ ì¶”ê°€
        document.getElementById('categoryForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const categoryData = {
                name: document.getElementById('categoryName').value,
                categoryType: document.getElementById('categoryType').value,
                icon: document.getElementById('categoryIcon').value,
                color: document.getElementById('categoryColor').value
            };
            
            if (isGuest) {
                // ë¹„íšŒì›ì€ ë¡œì»¬ ì¹´í…Œê³ ë¦¬ì— ì¶”ê°€
                const newCategory = {
                    ...categoryData,
                    id: 'custom_' + Date.now(),
                    isDefault: false
                };
                
                categories[categoryData.categoryType].push(newCategory);
                localStorage.setItem('guestCategories', JSON.stringify(categories));
                
                alert('ì¹´í…Œê³ ë¦¬ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
                document.getElementById('categoryForm').reset();
                updateCategoryDisplay();
            } else {
                // íšŒì›ì€ ì„œë²„ì— ì €ì¥
                try {
                    const response = await fetch(`${API_BASE}/categories`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${authToken}`
                        },
                        body: JSON.stringify(categoryData)
                    });
                    
                    if (response.ok) {
                        alert('ì¹´í…Œê³ ë¦¬ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
                        document.getElementById('categoryForm').reset();
                        loadServerData();
                        updateCategoryDisplay();
                    } else {
                        alert('ì¹´í…Œê³ ë¦¬ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                } catch (error) {
                    alert('ì¹´í…Œê³ ë¦¬ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            }
        });

        // ì¹´í…Œê³ ë¦¬ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateCategoryDisplay() {
            const expenseContainer = document.getElementById('expenseCategories');
            const incomeContainer = document.getElementById('incomeCategories');
            
            if (expenseContainer) {
                expenseContainer.innerHTML = categories.EXPENSE.map(category => 
                    createCategoryItem(category)
                ).join('');
            }
            
            if (incomeContainer) {
                incomeContainer.innerHTML = categories.INCOME.map(category => 
                    createCategoryItem(category)
                ).join('');
            }
        }

        // ì¹´í…Œê³ ë¦¬ ì•„ì´í…œ ìƒì„±
        function createCategoryItem(category) {
            const canDelete = !category.isDefault && (!isGuest || category.id.startsWith('custom_'));
            
            return `
                <div class="category-item" style="border-color: ${category.color};">
                    <div class="category-icon" style="background: ${category.color};">
                        ${category.icon}
                    </div>
                    <div class="category-info">
                        <div class="category-name">${category.name}</div>
                        <div class="category-type">${category.categoryType === 'EXPENSE' ? 'ì§€ì¶œ' : 'ìˆ˜ì…'}</div>
                    </div>
                    ${canDelete ? `<button class="delete-category" onclick="deleteCategory('${category.id}', '${category.categoryType}')">Ã—</button>` : ''}
                </div>
            `;
        }

        // ì¹´í…Œê³ ë¦¬ ì‚­ì œ
        async function deleteCategory(categoryId, categoryType) {
            if (!confirm('ì´ ì¹´í…Œê³ ë¦¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            if (isGuest) {
                // ë¹„íšŒì›ì€ ë¡œì»¬ì—ì„œ ì‚­ì œ
                categories[categoryType] = categories[categoryType].filter(cat => cat.id !== categoryId);
                localStorage.setItem('guestCategories', JSON.stringify(categories));
                updateCategoryDisplay();
                alert('ì¹´í…Œê³ ë¦¬ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            } else {
                // íšŒì›ì€ ì„œë²„ì—ì„œ ì‚­ì œ
                try {
                    const response = await fetch(`${API_BASE}/categories/${categoryId}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${authToken}`
                        }
                    });
                    
                    if (response.ok) {
                        loadServerData();
                        updateCategoryDisplay();
                        alert('ì¹´í…Œê³ ë¦¬ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    } else {
                        alert('ì¹´í…Œê³ ë¦¬ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                } catch (error) {
                    alert('ì¹´í…Œê³ ë¦¬ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            }
        }

        // ì°¨íŠ¸ ë¶„ì„ ê´€ë ¨ í•¨ìˆ˜ë“¤
        let currentChartPeriod = 'thisMonth';

        function setChartPeriod(period, element) {
            currentChartPeriod = period;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            if (element) {
                element.classList.add('active');
            }
            updateChartData();
        }

        function updateChartData() {
            const filteredTransactions = getFilteredTransactions(currentChartPeriod);
            updateChartSummary(filteredTransactions);
            updateCategoryChart(filteredTransactions);
            updateMonthlyTrend();
            updateWeeklyPattern(filteredTransactions);
        }

        function getFilteredTransactions(period) {
            const now = new Date();
            let startDate, endDate;

            switch(period) {
                case 'thisMonth':
                    startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                    endDate = new Date(now.getFullYear(), now.getMonth() + 1, 0);
                    break;
                case 'lastMonth':
                    startDate = new Date(now.getFullYear(), now.getMonth() - 1, 1);
                    endDate = new Date(now.getFullYear(), now.getMonth(), 0);
                    break;
                case 'last3Months':
                    startDate = new Date(now.getFullYear(), now.getMonth() - 2, 1);
                    endDate = new Date(now.getFullYear(), now.getMonth() + 1, 0);
                    break;
                case 'thisYear':
                    startDate = new Date(now.getFullYear(), 0, 1);
                    endDate = new Date(now.getFullYear(), 11, 31);
                    break;
            }

            return transactions.filter(t => {
                const transDate = new Date(t.transactionDate);
                return transDate >= startDate && transDate <= endDate;
            });
        }

        function updateChartSummary(filteredTransactions) {
            const totalIncome = filteredTransactions
                .filter(t => t.transactionType === 'INCOME')
                .reduce((sum, t) => sum + parseFloat(t.amount), 0);
            
            const totalExpense = filteredTransactions
                .filter(t => t.transactionType === 'EXPENSE')
                .reduce((sum, t) => sum + parseFloat(t.amount), 0);

            document.getElementById('chartTotalIncome').textContent = `â‚©${totalIncome.toLocaleString()}`;
            document.getElementById('chartTotalExpense').textContent = `â‚©${totalExpense.toLocaleString()}`;
            document.getElementById('chartNetAmount').textContent = `â‚©${(totalIncome - totalExpense).toLocaleString()}`;
        }

        function updateCategoryChart(filteredTransactions) {
            const expenseTransactions = filteredTransactions.filter(t => t.transactionType === 'EXPENSE');
            const categoryTotals = {};

            expenseTransactions.forEach(t => {
                const categoryName = t.category ? t.category.name : 'ê¸°íƒ€';
                const categoryColor = t.category ? t.category.color : '#DDA0DD';
                const categoryIcon = t.category ? t.category.icon : 'ğŸ“';
                
                if (!categoryTotals[categoryName]) {
                    categoryTotals[categoryName] = { amount: 0, color: categoryColor, icon: categoryIcon };
                }
                categoryTotals[categoryName].amount += parseFloat(t.amount);
            });

            const sortedCategories = Object.entries(categoryTotals)
                .sort(([,a], [,b]) => b.amount - a.amount);

            const totalExpense = sortedCategories.reduce((sum, [,data]) => sum + data.amount, 0);

            const chartHtml = sortedCategories.map(([name, data]) => {
                const percentage = totalExpense > 0 ? (data.amount / totalExpense * 100) : 0;
                return `
                    <div class="chart-item">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 24px;">${data.icon}</span>
                            <span>${name}</span>
                        </div>
                        <div style="flex: 1; margin: 0 20px;">
                            <div class="chart-bar">
                                <div class="chart-fill" style="width: ${percentage}%; background: ${data.color};"></div>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-weight: 600;">â‚©${data.amount.toLocaleString()}</div>
                            <div style="font-size: 12px; color: #666;">${percentage.toFixed(1)}%</div>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('categoryChart').innerHTML = chartHtml || '<p style="text-align: center; color: #666; padding: 40px;">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        }

        function updateMonthlyTrend() {
            const monthlyData = {};
            const now = new Date();
            
            // ìµœê·¼ 6ê°œì›” ë°ì´í„° ì¤€ë¹„
            for (let i = 5; i >= 0; i--) {
                const date = new Date(now.getFullYear(), now.getMonth() - i, 1);
                const key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                monthlyData[key] = { income: 0, expense: 0, month: date.getMonth() + 1 };
            }

            transactions.forEach(t => {
                const date = new Date(t.transactionDate);
                const key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                
                if (monthlyData[key]) {
                    if (t.transactionType === 'INCOME') {
                        monthlyData[key].income += parseFloat(t.amount);
                    } else if (t.transactionType === 'EXPENSE') {
                        monthlyData[key].expense += parseFloat(t.amount);
                    }
                }
            });

            const maxAmount = Math.max(...Object.values(monthlyData).map(d => Math.max(d.income, d.expense)));

            const trendHtml = Object.entries(monthlyData).map(([key, data]) => {
                const incomePercentage = maxAmount > 0 ? (data.income / maxAmount * 100) : 0;
                const expensePercentage = maxAmount > 0 ? (data.expense / maxAmount * 100) : 0;
                
                return `
                    <div class="chart-item">
                        <div style="width: 60px; text-align: center;">
                            <strong>${data.month}ì›”</strong>
                        </div>
                        <div style="flex: 1; margin: 0 20px;">
                            <div style="margin-bottom: 5px;">
                                <small style="color: #27ae60;">ìˆ˜ì…</small>
                                <div class="chart-bar" style="height: 12px;">
                                    <div class="chart-fill" style="width: ${incomePercentage}%; background: #27ae60;"></div>
                                </div>
                            </div>
                            <div>
                                <small style="color: #e74c3c;">ì§€ì¶œ</small>
                                <div class="chart-bar" style="height: 12px;">
                                    <div class="chart-fill" style="width: ${expensePercentage}%; background: #e74c3c;"></div>
                                </div>
                            </div>
                        </div>
                        <div style="text-align: right; font-size: 14px;">
                            <div style="color: #27ae60;">â‚©${data.income.toLocaleString()}</div>
                            <div style="color: #e74c3c;">â‚©${data.expense.toLocaleString()}</div>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('monthlyTrend').innerHTML = trendHtml;
        }

        function updateWeeklyPattern(filteredTransactions) {
            const weeklyData = { 0: 0, 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0 };
            const weekdays = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];

            filteredTransactions
                .filter(t => t.transactionType === 'EXPENSE')
                .forEach(t => {
                    const day = new Date(t.transactionDate).getDay();
                    weeklyData[day] += parseFloat(t.amount);
                });

            const maxAmount = Math.max(...Object.values(weeklyData));

            const patternHtml = Object.entries(weeklyData).map(([day, amount]) => {
                const percentage = maxAmount > 0 ? (amount / maxAmount * 100) : 0;
                return `
                    <div class="chart-item">
                        <div style="width: 40px; text-align: center;">
                            <strong>${weekdays[day]}</strong>
                        </div>
                        <div style="flex: 1; margin: 0 20px;">
                            <div class="chart-bar">
                                <div class="chart-fill" style="width: ${percentage}%; background: #667eea;"></div>
                            </div>
                        </div>
                        <div style="text-align: right; font-weight: 600;">
                            â‚©${amount.toLocaleString()}
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('weeklyPattern').innerHTML = patternHtml;
        }

        // ìì‚° ê´€ë¦¬ í•¨ìˆ˜ë“¤
        function updateAssetData() {
            // ìì‚° ì¹´í…Œê³ ë¦¬ ê±°ë˜ë§Œ í•„í„°ë§
            const assetTransactions = transactions.filter(t => 
                t.category && t.category.categoryType === 'ASSET'
            );

            const assetTotals = {};
            let totalAssets = 0;
            let liquidAssets = 0;
            let investmentAssets = 0;
            let totalDebt = 0;

            assetTransactions.forEach(t => {
                const categoryName = t.category.name;
                // ASSET íƒ€ì…ì€ í•­ìƒ ì–‘ìˆ˜ë¡œ ì²˜ë¦¬ (ìì‚°ì˜ í˜„ì¬ ì”ì•¡ì„ ì˜ë¯¸)
                const amount = parseFloat(t.amount);
                
                if (!assetTotals[categoryName]) {
                    assetTotals[categoryName] = {
                        amount: 0,
                        icon: t.category.icon,
                        color: t.category.color
                    };
                }
                assetTotals[categoryName].amount += amount;
            });

            // ìì‚° ë¶„ë¥˜
            Object.entries(assetTotals).forEach(([name, data]) => {
                if (['ì¹´ë“œì”ì•¡', 'ëŒ€ì¶œ', 'ì‹ ìš©ì¹´ë“œ', 'ë¶€ì±„'].includes(name)) {
                    // ë¶€ì±„ëŠ” ì´ìì‚°ì—ì„œ ì°¨ê°í•˜ê³  ë³„ë„ ì§‘ê³„
                    totalDebt += Math.abs(data.amount);
                    totalAssets -= Math.abs(data.amount); // ë¶€ì±„ëŠ” ì´ìì‚°ì—ì„œ ì°¨ê°
                } else {
                    // ì¼ë°˜ ìì‚°ì€ ì´ìì‚°ì— ì¶”ê°€
                    totalAssets += data.amount;
                    
                    if (['í˜„ê¸ˆ', 'ì€í–‰ì˜ˆê¸ˆ', 'ì ê¸ˆ'].includes(name)) {
                        liquidAssets += data.amount;
                    } else if (['íˆ¬ì', 'ì£¼ì‹', 'í€ë“œ'].includes(name)) {
                        investmentAssets += data.amount;
                    }
                }
            });

            // UI ì—…ë°ì´íŠ¸
            document.getElementById('totalAssets').textContent = `â‚©${totalAssets.toLocaleString()}`;
            document.getElementById('liquidAssets').textContent = `â‚©${liquidAssets.toLocaleString()}`;
            document.getElementById('investmentAssets').textContent = `â‚©${investmentAssets.toLocaleString()}`;
            document.getElementById('totalDebt').textContent = `â‚©${totalDebt.toLocaleString()}`;

            // ìì‚° ëª©ë¡ ì—…ë°ì´íŠ¸
            updateAssetLists(assetTotals);
        }

        function updateAssetLists(assetTotals) {
            const cashAssets = [];
            const investments = [];
            const debts = [];

            Object.entries(assetTotals).forEach(([name, data]) => {
                const isDebt = ['ì¹´ë“œì”ì•¡', 'ëŒ€ì¶œ', 'ì‹ ìš©ì¹´ë“œ', 'ë¶€ì±„'].includes(name);
                const displayAmount = Math.abs(data.amount);
                
                const item = `
                    <div class="transaction-item">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 24px;">${data.icon}</span>
                            <span>${name}</span>
                        </div>
                        <div class="amount ${isDebt ? 'expense-amount' : 'income-amount'}">
                            â‚©${displayAmount.toLocaleString()}
                        </div>
                    </div>
                `;

                if (isDebt) {
                    debts.push(item);
                } else if (['í˜„ê¸ˆ', 'ì€í–‰ì˜ˆê¸ˆ', 'ì ê¸ˆ'].includes(name)) {
                    cashAssets.push(item);
                } else if (['íˆ¬ì', 'ì£¼ì‹', 'í€ë“œ'].includes(name)) {
                    investments.push(item);
                } else {
                    // ê¸°íƒ€ ìì‚°ì€ í˜„ê¸ˆì„± ìì‚°ìœ¼ë¡œ ë¶„ë¥˜
                    cashAssets.push(item);
                }
            });

            document.getElementById('cashAssets').innerHTML = 
                cashAssets.length > 0 ? cashAssets.join('') : '<p style="text-align: center; color: #666; padding: 20px;">í˜„ê¸ˆì„± ìì‚°ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            
            document.getElementById('investmentAssetsList').innerHTML = 
                investments.length > 0 ? investments.join('') : '<p style="text-align: center; color: #666; padding: 20px;">íˆ¬ì ìì‚°ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            
            document.getElementById('debtList').innerHTML = 
                debts.length > 0 ? debts.join('') : '<p style="text-align: center; color: #666; padding: 20px;">ë¶€ì±„ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        }

        // ì„¤ì • ê´€ë ¨ í•¨ìˆ˜ë“¤
        function loadSettings() {
            if (!isGuest) {
                const userName = localStorage.getItem('userName') || '';
                const userEmail = localStorage.getItem('userEmail') || '';
                document.getElementById('settingsName').value = userName;
                document.getElementById('settingsEmail').value = userEmail;
            }

            // ì„¤ì • ë¡œë“œ
            const currency = localStorage.getItem('currency') || 'KRW';
            document.getElementById('currency').value = currency;

            const notifications = JSON.parse(localStorage.getItem('notifications') || '{}');
            document.getElementById('dailyNotification').checked = notifications.daily || false;
            document.getElementById('budgetAlert').checked = notifications.budget || false;
            document.getElementById('weeklyReport').checked = notifications.weekly || false;
        }

        function saveSettings() {
            const currency = document.getElementById('currency').value;
            localStorage.setItem('currency', currency);

            const notifications = {
                daily: document.getElementById('dailyNotification').checked,
                budget: document.getElementById('budgetAlert').checked,
                weekly: document.getElementById('weeklyReport').checked
            };
            localStorage.setItem('notifications', JSON.stringify(notifications));
        }

        function exportData() {
            const csvData = transactions.map(t => [
                t.transactionDate,
                t.transactionType,
                t.category ? t.category.name : 'ê¸°íƒ€',
                t.amount,
                t.description || ''
            ]);

            csvData.unshift(['ë‚ ì§œ', 'ìœ í˜•', 'ì¹´í…Œê³ ë¦¬', 'ê¸ˆì•¡', 'ì„¤ëª…']);

            const csvContent = csvData.map(row => row.join(',')).join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `unble_data_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function showImportData() {
            showImportModal();
        }

        function showImportModal() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0,0,0,0.5); z-index: 1000;
                display: flex; align-items: center; justify-content: center;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 10px; max-width: 500px; width: 90%;">
                    <h3 style="margin-bottom: 20px; color: #333;">ğŸ“¥ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°</h3>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 10px; font-weight: bold;">íŒŒì¼ ì„ íƒ:</label>
                        <input type="file" id="importFile" accept=".csv,.json,.xlsx,.xls" 
                               style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 10px; font-weight: bold;">íŒŒì¼ í˜•ì‹:</label>
                        <select id="importFormat" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                            <option value="csv">CSV íŒŒì¼</option>
                            <option value="json">JSON íŒŒì¼</option>
                            <option value="excel">Excel íŒŒì¼</option>
                        </select>
                    </div>
                    
                    <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
                        <h4 style="margin-bottom: 10px; color: #666;">ğŸ“‹ CSV í˜•ì‹ ì˜ˆì‹œ:</h4>
                        <code style="font-size: 12px; color: #666;">
                            ë‚ ì§œ,ì„¤ëª…,ê¸ˆì•¡,ì¹´í…Œê³ ë¦¬,ê±°ë˜íƒ€ì…<br>
                            2024-01-01,ì ì‹¬ì‹ì‚¬,15000,ì‹ë¹„,EXPENSE<br>
                            2024-01-01,ê¸‰ì—¬,2500000,ê¸‰ì—¬,INCOME
                        </code>
                        <div style="margin-top: 10px;">
                            <button onclick="downloadTemplate()" style="padding: 5px 10px; background: #28a745; color: white; border: none; border-radius: 3px; font-size: 12px;">
                                ğŸ“„ í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ
                            </button>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button onclick="closeImportModal()" 
                                style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 5px;">
                            ì·¨ì†Œ
                        </button>
                        <button onclick="previewImport()" 
                                style="padding: 10px 20px; background: #17a2b8; color: white; border: none; border-radius: 5px;">
                            ë¯¸ë¦¬ë³´ê¸°
                        </button>
                        <button onclick="executeImport()" 
                                style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px;">
                            ê°€ì ¸ì˜¤ê¸°
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            window.currentImportModal = modal;
        }

        function closeImportModal() {
            if (window.currentImportModal) {
                document.body.removeChild(window.currentImportModal);
                window.currentImportModal = null;
            }
        }

        async function downloadTemplate() {
            try {
                const response = await fetch(`${API_BASE}/data-import/template/csv`, {
                    headers: authToken ? { 'Authorization': `Bearer ${authToken}` } : {}
                });
                
                if (response.ok) {
                    const csvContent = await response.text();
                    const blob = new Blob([csvContent], { type: 'text/csv' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'transaction_template.csv';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                } else {
                    alert('í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                alert('í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        async function previewImport() {
            const fileInput = document.getElementById('importFile');
            const formatSelect = document.getElementById('importFormat');
            
            if (!fileInput.files[0]) {
                alert('íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (isGuest) {
                alert('ê²ŒìŠ¤íŠ¸ ëª¨ë“œì—ì„œëŠ” ë°ì´í„° ê°€ì ¸ì˜¤ê¸°ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            formData.append('format', formatSelect.value);
            
            try {
                const response = await fetch(`${API_BASE}/data-import/preview`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showPreviewModal(result);
                } else {
                    alert('ë¯¸ë¦¬ë³´ê¸° ì‹¤íŒ¨: ' + result.message);
                }
            } catch (error) {
                alert('ë¯¸ë¦¬ë³´ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        function showPreviewModal(result) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0,0,0,0.5); z-index: 1001;
                display: flex; align-items: center; justify-content: center;
            `;
            
            const previewRows = result.preview.map(item => `
                <tr>
                    <td>${item.transactionDate}</td>
                    <td>${item.description}</td>
                    <td>â‚©${item.amount.toLocaleString()}</td>
                    <td>${item.transactionType}</td>
                </tr>
            `).join('');
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 10px; max-width: 800px; width: 90%; max-height: 80%; overflow-y: auto;">
                    <h3 style="margin-bottom: 20px; color: #333;">ğŸ‘€ ë°ì´í„° ë¯¸ë¦¬ë³´ê¸°</h3>
                    
                    <div style="margin-bottom: 20px; display: flex; gap: 20px;">
                        <div style="padding: 10px; background: #e3f2fd; border-radius: 5px;">
                            <strong>ì´ ${result.totalCount}ê°œ</strong> ê±°ë˜
                        </div>
                        <div style="padding: 10px; background: #e8f5e8; border-radius: 5px;">
                            <strong>${result.validCount}ê°œ</strong> ìœ íš¨
                        </div>
                        <div style="padding: 10px; background: #fff3e0; border-radius: 5px;">
                            <strong>${result.invalidCount}ê°œ</strong> ì˜¤ë¥˜
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 10px;">ì²˜ìŒ 10ê°œ ë°ì´í„°:</h4>
                        <table style="width: 100%; border-collapse: collapse; border: 1px solid #ddd;">
                            <thead>
                                <tr style="background: #f8f9fa;">
                                    <th style="padding: 10px; border: 1px solid #ddd;">ë‚ ì§œ</th>
                                    <th style="padding: 10px; border: 1px solid #ddd;">ì„¤ëª…</th>
                                    <th style="padding: 10px; border: 1px solid #ddd;">ê¸ˆì•¡</th>
                                    <th style="padding: 10px; border: 1px solid #ddd;">íƒ€ì…</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${previewRows}
                            </tbody>
                        </table>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button onclick="closePreviewModal()" 
                                style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 5px;">
                            ë‹«ê¸°
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            window.currentPreviewModal = modal;
        }

        function closePreviewModal() {
            if (window.currentPreviewModal) {
                document.body.removeChild(window.currentPreviewModal);
                window.currentPreviewModal = null;
            }
        }

        async function executeImport() {
            const fileInput = document.getElementById('importFile');
            const formatSelect = document.getElementById('importFormat');
            
            if (!fileInput.files[0]) {
                alert('íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (isGuest) {
                alert('ê²ŒìŠ¤íŠ¸ ëª¨ë“œì—ì„œëŠ” ë°ì´í„° ê°€ì ¸ì˜¤ê¸°ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!confirm('ì„ íƒí•œ íŒŒì¼ì˜ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            
            const endpoints = {
                'csv': '/data-import/csv',
                'json': '/data-import/json',
                'excel': '/data-import/excel'
            };
            
            try {
                const response = await fetch(`${API_BASE}${endpoints[formatSelect.value]}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert(`ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ!\nì„±ê³µ: ${result.successCount}ê°œ\nì‹¤íŒ¨: ${result.failCount}ê°œ`);
                    closeImportModal();
                    if (!isGuest) {
                        loadServerData(); // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
                    }
                } else {
                    alert('ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨: ' + result.message);
                }
            } catch (error) {
                alert('ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        function clearAllData() {
            if (confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                if (isGuest) {
                    localStorage.removeItem('guestTransactions');
                    localStorage.removeItem('guestCategories');
                    transactions = [];
                    loadLocalData();
                } else {
                    alert('íšŒì› ë°ì´í„° ì‚­ì œëŠ” ê³ ê°ì„¼í„°ì— ë¬¸ì˜í•´ì£¼ì„¸ìš”.');
                }
            }
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        window.onclick = function(event) {
            if (event && event.target && event.target.classList && event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        };
        
        // ì „ì—­ ì—ëŸ¬ í•¸ë“¤ëŸ¬
        window.onerror = function(message, source, lineno, colno, error) {
            console.error('ì „ì—­ ì˜¤ë¥˜:', {message, source, lineno, colno, error});
            return false; // ê¸°ë³¸ ì—ëŸ¬ ì²˜ë¦¬ë¥¼ ë§‰ì§€ ì•ŠìŒ
        };
        
        // Promise rejection í•¸ë“¤ëŸ¬
        window.addEventListener('unhandledrejection', function(event) {
            console.error('ì²˜ë¦¬ë˜ì§€ ì•Šì€ Promise ê±°ë¶€:', event.reason);
            event.preventDefault(); // ì½˜ì†”ì— ì˜¤ë¥˜ í‘œì‹œ ë°©ì§€
        });
    </script>
</body>
</html>